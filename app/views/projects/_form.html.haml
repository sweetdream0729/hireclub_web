= form_for @project do |f|
  - if @project.errors.any?
    #error_explanation
      %h2= "#{pluralize(@project.errors.count, "error")} prohibited this project from being saved:"
      %ul
        - @project.errors.full_messages.each do |msg|
          %li= msg
  .row
    .col-6
      .form-group
        = link_to "Upload Image", "#", class: "btn btn-primary", id: "upload_widget_opener"
        = f.label 'Image Upload'
        = f.hidden_field :image_uid

        %br
        = image_tag(model_image(@project.image, 800, 600, true), width: 300, id: "image_preview")
        / = f.file_field :image, class: 'form-control-file mt-2'
        / = f.hidden_field :retained_image
        
        %small.form-text.text-muted
          800x600 minimum. JPG, PNG, or GIF.
        %small.form-text.text-muted
          10MB maximum file size.
      / .form-group
      /   = f.label "Or Paste URL to Image"
      /   = f.text_field :image_url, placeholder: "http://hireclub.co/logo.jpg", class: 'form-control'      
      
    .col-6
      .form-group
        = f.label :name
        = f.text_field :name, class: 'form-control'
      .form-group
        = f.label "Link To"
        = f.text_field :link, class: 'form-control', placeholder: "http://"
      .form-group
        = f.label "Skills"
        = f.text_field :skills_list, placeholder: "Design, Rails, Marketing"

      .form-group
        = f.label :company
        = f.text_field :company, class: "form-control autocomplete_company", value: @project.company.try(:name), placeholder: "HireClub", autocomplete: "off"
        = f.hidden_field :company_id, value: @project.company_id, class: "autocomplete_company_id"

      .form-group
        = f.label :position
        = f.number_field :position, class: 'form-control', min: 0

      .form-group
        = f.label :description
        = f.text_area :description, class: 'form-control', placeholder: "Describe the project...", rows: 4

    
    

      %hr
      = f.submit 'Save', class: "btn btn-primary btn-lg"
      = link_to "Cancel", current_user, class: "btn btn-link btn-lg"

- content_for :head do
  %link{:href => "https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css", :rel => "stylesheet"}/
  %script{:src => "https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"}

:javascript
  var simplemde = new SimpleMDE({ element: document.getElementById("project_description") });

%script{:src => "//widget.cloudinary.com/global/all.js", :type => "text/javascript"}
:javascript
  document.getElementById("upload_widget_opener").addEventListener("click", function() {
    console.log("click")
    cloudinary.openUploadWidget({ 
      cloud_name: "#{Rails.application.secrets.cloudinary_name}", 
      upload_preset: 'project_upload',
      cropping: 'server',
      cropping_aspect_ratio: 1.333333333333333,
      cropping_show_dimensions: true,
      multiple: false}, 
      function(error, result) { 
      console.log(error, result)
        if(result) {
          image_uid = result[0].public_id;
          image_url = result[0].secure_url;
          console.log("image_uid:"+image_uid)
          console.log("image_url:"+image_url)
          $('#project_image_uid').val(image_uid);
          $('#image_preview').attr("src", image_url)
        }
      });

  }, false);